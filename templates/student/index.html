<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Student Dashboard - Trinity Theological Seminary</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
<link rel="stylesheet" href="{% static 'css/student/index.css' %}">
    <!-- <style>



    </style> -->
</head>
<!-- <body> -->
<body class="{% block body_class %}{% endblock %}">


    <!-- Main Navigation -->
    <div class="main-nav">
        <div class="nav-content">
<div class="logo-section">
<img src="{% static 'img/Trinity_final2.png' %}" style="width:180px; height: 50px;">

</div>

            <button class="mobile-menu-btn" onclick="toggleMenu()">â˜°</button>
            <ul class="nav-links" id="navLinks">

                <li class="nav-item mobile-only" onclick="toggleDropdown(this, event)">
                    <span class="nav-link">ğŸ‘¤ Profile â–¼</span>
                    <div class="dropdown">
                        <a href="{% url 'student_profile_view' %}">ğŸ‘¤ My Profile</a>
                        <a href="#">ğŸ“Š Change Password</a>
                        <div class="divider"></div>
                        <a href="#">ğŸšª Logout</a>
                    </div>
                </li>

                <li class="nav-item">
                    <a href="{% url role|add:'_home' %}" class="nav-link">ğŸ  Home</a>
                </li>


                <!-- <h1>user=={{request.user.user_roles.first.role.name }}</h1> -->

{% if request.user.user_roles.first.role.name == "Student" %}
    <li class="nav-item">
        <span class="nav-link">ğŸ“š My Class â–¼</span>
        <div class="dropdown">
            <a href="{% url role|add:'_subjects' %}">ğŸ“– Subjects</a>

            <div class="sub-parent" onclick="openRightMenu(event)">
                <a href="#">ğŸ“ Assignment â–¸</a>
                <div class="right-submenu">
                    <a href="{% url 'student_pending_assignment' %}">Upload Assignment</a>
                    <a href="{% url 'student_submitted_assignment' %}">Submitted Assignments</a>
                </div>
            </div>

            <a href="{% url 'student_view_post' %}">ğŸ‘ï¸ View Post</a>
            <a href="#">ğŸ¥ Live Class</a>
        </div>
    </li>
{% else %}
    <li class="nav-item">
        <span class="nav-link">ğŸ“š My Class â–¼</span>
        <div class="dropdown">
            <a href="{% url role|add:'_subjects' %}">ğŸ“– Subjects</a>

        </div>
    </li>
{% endif %}


<li class="nav-item">
    <span class="nav-link">ğŸ“‹ Exam â–¼</span>
    <!-- <div class="dropdown">...</div> -->
        <div class="dropdown">
        <a href="{% url role|add:'_exam_hall' %}">âœï¸ Exam Hall</a>
        
        <div class="sub-parent" onclick="openRightMenu(event)">
            <a href="{% url role|add:'_score_card' %}">ğŸ“Š Score Card </a>
        </div>
        
    </div>
</li>
<li class="nav-item">
    <span class="nav-link">ğŸ“š Library â–¼</span>
    <!-- <div class="dropdown">...</div> -->
        <div class="dropdown">
        
        <div class="sub-parent" onclick="openRightMenu(event)">
            <a href="#">ğŸ“‘ References </a>
        </div>
        
        <a href="{% url role|add:'_class_recordings' %}">ğŸ“¼ Class Recordings</a>
    </div>
</li>
<li><br></li>
<li>
    <div class="user-profile-header-containe " >
        <div class="user-profile-header"  onclick="toggleUserDropdown(event)">
            <div class="user-avatar-small" style="width: 40px !important; height: 40px !important; border-radius: 50% !important; aspect-ratio: 1/1;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color: white;">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
            </div>
            <!-- <span style="font-size: 0.75rem; margin-left: 8px; font-weight: 600; color: #374151;">{{student.first_name|slice:":1"|upper}}</span> -->

            <div class="user-dropdown" id="userDropdown" onclick="event.stopPropagation()">
                <!-- <a href="{% url 'student_profile_view' %}">ğŸ‘¤ My Profile</a> -->
                <a href="{% url role|add:'_profile_view' %}">ğŸ‘¤ My Profile</a>

                <a href="{% url role|add:'_change_password' %}">ğŸ“Š Change Password</a>
                <div class="divider"></div>
                <a href="#">ğŸšª Logout</a>
            </div>
        </div>
    </div>
</li>

            </ul>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Column - Profile -->
        <div>
            <div class="profile-card">
                <div class="profile-avatar">ğŸ‘¤</div>
                <h2 class="profile-name">{{ student.first_name}}</h2>
                <p class="profile-id">{{ student.student_id}}</p>
                <span class="role-badge">ğŸ‘¨â€ğŸ“ Student</span>
                 <br><br>
                 <a href="{% url role|add:'_payment_input' %}" target="_blank" class="pay-button" style="text-decoration: none !important;">ğŸ’³ Pay Now</a>
                <div class="stats-wrapper">
                <div class="stats-grid ">
                    <br><br><br><br><br><br><br><br>
                </div>
                </div>

            </div>
        </div>

        <!-- Middle Column - Details (template block) -->

        <div class="middle-column">
    {% block middle %}{% endblock %}
</div>

<div class="right-column">
    {% block right %}{% endblock %}
</div>


    </div>

    <script>


const navItems = document.querySelectorAll(".nav-item");

        function toggleUserDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById("userDropdown");
            dropdown.classList.toggle("show");
        }

        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
            
            // Close all nav-item dropdowns when main menu is closed
            if (!navLinks.classList.contains('active')) {
                navItems.forEach(item => item.classList.remove("active"));
            }
        }

        function toggleDropdown(element, event) {
            // This function is now only called via the event listener setup below
            // and should handle mobile-only logic

            // Check if it's a link with a valid href, if so, let it navigate (unless it's a sub-parent)
            const link = element.querySelector('.nav-link');
            if (link && link.href && !element.classList.contains('sub-parent')) {
                 // For mobile, if it has a link, only toggle if it's not a parent dropdown
                 if (element.querySelector('.dropdown')) {
                     event.preventDefault(); // Prevent navigation on mobile if it has a dropdown
                 }
            } else {
                 event.preventDefault(); // Prevent default action for mobile toggle
            }
            
            event.stopPropagation();

            // Close other dropdowns
            navItems.forEach(item => {
                if (item !== element) item.classList.remove("active");
            });

            element.classList.toggle("active");
        }


        function openRightMenu(event) {
            event.stopPropagation();
            const menu = event.currentTarget.querySelector(".right-submenu");
            document.querySelectorAll(".right-submenu").forEach(m => {
                if (m !== menu) m.style.display = "none";
            });
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        document.addEventListener("click", (event) => {
            const userDropdown = document.getElementById("userDropdown");
            const userProfile = document.querySelector(".user-profile-header");
            
            // Close User Dropdown
            if (userDropdown && userProfile && !userProfile.contains(event.target)) {
                userDropdown.classList.remove("show");
            }
            
            // Close right sub-menu
            document.querySelectorAll(".right-submenu").forEach(m => m.style.display = "none");

            // Close mobile nav dropdowns if click is outside nav bar
            if (window.innerWidth <= 968) {
                const nav = document.querySelector('.main-nav');
                if (!nav.contains(event.target)) {
                    navItems.forEach(item => item.classList.remove("active"));
                }
            }
        });

        document.addEventListener('click', function(event) {
            const nav = document.querySelector('.main-nav');
            const navLinks = document.getElementById('navLinks');
            if (!nav.contains(event.target) && navLinks && navLinks.classList.contains('active')) {
                navLinks.classList.remove('active');
            }
        });

        // Add event listeners for mobile-only dropdown toggle
        document.addEventListener('DOMContentLoaded', () => {
            navItems.forEach(item => {
                const navLink = item.querySelector('.nav-link');
                if (navLink) {
                    navLink.addEventListener('click', function(event) {
                        // Only run the mobile-specific toggle logic
                        if (window.innerWidth <= 968 && item.querySelector('.dropdown')) {
                            toggleDropdown(item, event);
                        }
                    });
                }
            });

            // Re-add the mobile-only click handler to the mobile-only profile dropdown
            const mobileProfile = document.querySelector('.nav-item.mobile-only');
            if (mobileProfile) {
                mobileProfile.addEventListener('click', function(event) {
                    if (window.innerWidth <= 968) {
                        toggleDropdown(mobileProfile, event);
                    }
                });
            }
        });
        function toggleUserDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById("userDropdown");
            dropdown.classList.toggle("show");
        }

        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

function toggleDropdown(element, event) {
    if (window.innerWidth <= 968) {
        event.preventDefault();
        event.stopPropagation();

        document.querySelectorAll(".nav-item").forEach(item => {
            if (item !== element) item.classList.remove("active");
        });

        element.classList.toggle("active");
    }
}


        function openRightMenu(event) {
            event.stopPropagation();
            const menu = event.currentTarget.querySelector(".right-submenu");
            document.querySelectorAll(".right-submenu").forEach(m => {
                if (m !== menu) m.style.display = "none";
            });
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        document.addEventListener("click", (event) => {
            const userDropdown = document.getElementById("userDropdown");
            const userProfile = document.querySelector(".user-profile-header");
            
            if (userDropdown && userProfile && !userProfile.contains(event.target)) {
                userDropdown.classList.remove("show");
            }
            
            document.querySelectorAll(".right-submenu").forEach(m => m.style.display = "none");
        });

        document.addEventListener('click', function(event) {
            const nav = document.querySelector('.main-nav');
            const navLinks = document.getElementById('navLinks');
            if (!nav.contains(event.target) && navLinks && navLinks.classList.contains('active')) {
                navLinks.classList.remove('active');
            }
        });
        
    </script>
</body>
</html>



