{% extends "student/index.html" %}

{% block middle %}
<style>
/* ----------------- MIDDLE BLOCK STYLES ----------------- */
.password-change-container {
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,.1);
    overflow: hidden;
    max-width: 600px;
    margin: 0 auto;
}

.password-header {
    background: linear-gradient(135deg, #00CED1, #00b4b8);
    padding: 24px 32px;
    color: #fff;
}

.password-header h1 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

.password-form-content {
    padding: 32px;
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #334155;
    font-size: 14px;
}

.input-wrapper {
    position: relative;
}

.input-wrapper input {
    width: 100%;
    padding: 12px 44px 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    background: #f9fafb;
    font-size: 14px;
    transition: all 0.2s ease;
}

.input-wrapper input:focus {
    outline: none;
    border-color: #00CED1;
    background: white;
}

.toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: none;
    cursor: pointer;
    font-size: 18px;
    opacity: 0.6;
    transition: opacity 0.2s;
}

.toggle-password:hover {
    opacity: 1;
}

.error-message {
    font-size: 13px;
    color: #EF4444;
    opacity: 0;
    margin-top: 6px;
    transition: opacity 0.2s;
}

.error-message.visible {
    opacity: 1;
}

.success-message {
    font-size: 13px;
    color: #10B981;
    opacity: 0;
    margin-top: 6px;
    transition: opacity 0.2s;
}

.success-message.visible {
    opacity: 1;
}

.btn-primary {
    width: 100%;
    padding: 14px 24px;
    background: linear-gradient(135deg, #00CED1, #00b4b8);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 8px;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 206, 209, 0.3);
}

/* ----------------- RIGHT BLOCK ----------------- */
.right-panel {
    padding: 20px;
    background: #f8fafc;
    border-radius: 12px;
}

/* Main strength bar */
.password-strength {
    height: 8px;
    background: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
    opacity: 0;
    transition: opacity 0.25s;
    margin-bottom: 16px;
}

.password-strength.visible {
    opacity: 1;
}

.password-strength-bar {
    height: 100%;
    width: 0;
    transition: all 0.4s ease;
    border-radius: 4px;
}

.password-strength-bar.weak {
    width: 33%;
    background: linear-gradient(90deg, #EF4444, #DC2626);
}

.password-strength-bar.medium {
    width: 66%;
    background: linear-gradient(90deg, #F59E0B, #D97706);
}

.password-strength-bar.strong {
    width: 100%;
    background: linear-gradient(90deg, #10B981, #059669);
}

/* 3-STEP strength meter */
.strength-meter {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}

.strength-meter .step {
    flex: 1;
    height: 8px;
    border-radius: 4px;
    background: #e5e7eb;
    transition: all 0.3s ease;
}

.step.active-weak {
    background: linear-gradient(90deg, #EF4444, #DC2626);
}

.step.active-medium {
    background: linear-gradient(90deg, #F59E0B, #D97706);
}

.step.active-strong {
    background: linear-gradient(90deg, #10B981, #059669);
}

.strength-label {
    font-size: 14px;
    font-weight: 600;
    height: 20px;
    margin-bottom: 8px;
    text-align: center;
}

.password-hint {
    font-size: 13px;
    color: #64748B;
    opacity: 0;
    margin-bottom: 16px;
    text-align: center;
    font-weight: 500;
    transition: opacity 0.2s;
}

.password-hint.visible {
    opacity: 1;
}

/* Requirements list - Enhanced */
.requirements {
    background: white;
    padding: 16px;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
    margin-top: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.requirements-title {
    font-size: 14px;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.requirements-title::before {
    content: "üîí";
    font-size: 16px;
}

.requirement-item {
    font-size: 13px;
    color: #64748B;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 4px;
    transition: all 0.3s ease;
    border-radius: 6px;
    margin-bottom: 4px;
}

.requirement-item:hover {
    background: #f8fafc;
    padding-left: 8px;
}

/* Circle icon - default */
.requirement-item::before {
    content: "";
    width: 18px;
    height: 18px;
    border: 2px solid #cbd5e1;
    border-radius: 50%;
    flex-shrink: 0;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
}

/* Checkmark when met */
.requirement-item.met {
    color: #059669;
    font-weight: 600;
}

.requirement-item.met::before {
    content: "‚úì";
    border-color: #10B981;
    background: #10B981;
    color: white;
    font-size: 12px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Animation for met requirement */
@keyframes checkPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.requirement-item.met::before {
    animation: checkPulse 0.3s ease;
}

/* Responsive */
@media (max-width: 768px) {
    .password-change-container {
        margin: 16px;
    }
    
    .password-form-content {
        padding: 24px 20px;
    }
    
    .right-panel {
        margin-top: 20px;
    }
}
</style>

<div class="password-change-container">
    <div class="password-header">
        <h1>Change Password</h1>
    </div>

    <div class="password-form-content">
        <form id="passwordForm">
            <!-- Current password -->
            <div class="form-group">
                <label>Current Password</label>
                <div class="input-wrapper">
                    <input type="password" id="currentPassword" placeholder="Enter current password">
                    <button type="button" class="toggle-password" data-target="currentPassword">üëÅ</button>
                </div>
                <div id="currentPasswordError" class="error-message"></div>
            </div>

            <!-- New password -->
            <div class="form-group">
                <label>New Password</label>
                <div class="input-wrapper">
                    <input type="password" id="newPassword" placeholder="Enter new password">
                    <button type="button" class="toggle-password" data-target="newPassword">üëÅ</button>
                </div>
            </div>

            <!-- Confirm password -->
            <div class="form-group">
                <label>Confirm New Password</label>
                <div class="input-wrapper">
                    <input type="password" id="confirmPassword" placeholder="Confirm new password">
                    <button type="button" class="toggle-password" data-target="confirmPassword">üëÅ</button>
                </div>
                <div id="confirmPasswordError" class="error-message"></div>
                <div id="confirmPasswordSuccess" class="success-message"></div>
            </div>

            <button type="submit" id="submitBtn" class="btn-primary">Change Password</button>
        </form>
    </div>
</div>

<script>
/* ========== ELEMENTS ========== */
const newPasswordInput = document.getElementById("newPassword");
const confirmPasswordInput = document.getElementById("confirmPassword");

/* right */
const rightStrength = document.querySelector("#right-block .password-strength");
const rightStrengthBar = document.querySelector("#right-block .password-strength-bar");
const rightHint = document.querySelector("#right-block .password-hint");
const requirementItems = document.querySelectorAll("#right-block .requirement-item");

/* 3 step meter */
const steps = document.querySelectorAll("#strength-meter .step");
const strengthLabel = document.getElementById("strength-label");

/* ========== PASSWORD CHECK FUNCTION ========== */
function evaluatePassword(pwd) {
    const req = {
        length: pwd.length >= 8,
        uppercase: /[A-Z]/.test(pwd),
        lowercase: /[a-z]/.test(pwd),
        number: /[0-9]/.test(pwd),
        special: /[^A-Za-z0-9]/.test(pwd)
    };

    let score = Object.values(req).filter(v => v).length;
    return { score, req };
}

/* ========== UPDATE UI ========== */
function updateUI(pwd) {
    if (!pwd) {
        rightStrength.classList.remove("visible");
        rightHint.classList.remove("visible");
        rightStrengthBar.className = "password-strength-bar";
        requirementItems.forEach(r => r.classList.remove("met"));
        steps.forEach(s => s.className = "step");
        strengthLabel.textContent = "";
        return;
    }

    const { score, req } = evaluatePassword(pwd);

    /* update requirements */
    Object.keys(req).forEach(key => {
        const el = document.querySelector(`#right-block [data-req="${key}"]`);
        if (el) {
            if (req[key]) {
                el.classList.add("met");
            } else {
                el.classList.remove("met");
            }
        }
    });

    /* right bar */
    rightStrength.classList.add("visible");
    rightStrengthBar.className = "password-strength-bar";

    /* 3-step meter */
    steps.forEach(s => s.className = "step");

    if (score <= 2) {
        rightStrengthBar.classList.add("weak");
        steps[0].classList.add("active-weak");
        strengthLabel.textContent = "Weak";
        strengthLabel.style.color = "#EF4444";
        rightHint.textContent = "‚ö†Ô∏è Weak password";
        rightHint.style.color = "#EF4444";
    } else if (score <= 4) {
        rightStrengthBar.classList.add("medium");
        steps[0].classList.add("active-medium");
        steps[1].classList.add("active-medium");
        strengthLabel.textContent = "Medium";
        strengthLabel.style.color = "#F59E0B";
        rightHint.textContent = "‚ö° Medium strength";
        rightHint.style.color = "#F59E0B";
    } else {
        rightStrengthBar.classList.add("strong");
        steps[0].classList.add("active-strong");
        steps[1].classList.add("active-strong");
        steps[2].classList.add("active-strong");
        strengthLabel.textContent = "Strong";
        strengthLabel.style.color = "#10B981";
        rightHint.textContent = "‚úì Strong password";
        rightHint.style.color = "#10B981";
    }

    rightHint.classList.add("visible");
}

/* ========== INPUT LISTENER ========== */
newPasswordInput.addEventListener("input", e => {
    updateUI(e.target.value);
});

/* ====== TOGGLE PASSWORD (EYE ICON) ====== */
document.querySelectorAll(".toggle-password").forEach(btn => {
    btn.addEventListener("click", function () {
        const targetId = this.getAttribute("data-target");
        const input = document.getElementById(targetId);

        if (input.type === "password") {
            input.type = "text";
            this.textContent = "üôà";
        } else {
            input.type = "password";
            this.textContent = "üëÅ";
        }
    });
});

/* ====== CONFIRM PASSWORD VALIDATION ====== */
confirmPasswordInput.addEventListener("input", function() {
    const newPwd = newPasswordInput.value;
    const confirmPwd = this.value;
    const errorMsg = document.getElementById("confirmPasswordError");
    const successMsg = document.getElementById("confirmPasswordSuccess");
    
    if (confirmPwd === "") {
        errorMsg.classList.remove("visible");
        successMsg.classList.remove("visible");
        return;
    }
    
    if (newPwd !== confirmPwd) {
        errorMsg.textContent = "Passwords do not match";
        errorMsg.classList.add("visible");
        successMsg.classList.remove("visible");
    } else {
        errorMsg.classList.remove("visible");
        successMsg.textContent = "‚úì Passwords match";
        successMsg.classList.add("visible");
    }
});

/* ====== FORM SUBMISSION ====== */
document.getElementById("passwordForm").addEventListener("submit", function(e) {
    e.preventDefault();
    
    const currentPwd = document.getElementById("currentPassword").value;
    const newPwd = newPasswordInput.value;
    const confirmPwd = confirmPasswordInput.value;
    
    if (!currentPwd || !newPwd || !confirmPwd) {
        alert("Please fill in all fields");
        return;
    }
    
    if (newPwd !== confirmPwd) {
        alert("New passwords do not match");
        return;
    }
    
    const { score } = evaluatePassword(newPwd);
    if (score < 5) {
        alert("Please create a stronger password that meets all requirements");
        return;
    }
    
    // Submit the form or make API call here
    alert("Password changed successfully!");
});
</script>

{% endblock %}

{% block right %}
<div id="right-block" class="right-panel">
    <!-- RIGHT main strength bar -->
    <div class="password-strength">
        <div class="password-strength-bar"></div>
    </div>


    <div id="strength-label" class="strength-label"></div>

    <!-- Hint -->
    <div class="password-hint"></div>

    <!-- Requirements -->
    <div class="requirements">
        <div class="requirements-title">Password Requirements</div>
        <div class="requirement-item" data-req="length">At least 8 characters</div>
        <div class="requirement-item" data-req="uppercase">One uppercase letter</div>
        <div class="requirement-item" data-req="lowercase">One lowercase letter</div>
        <div class="requirement-item" data-req="number">One number</div>
        <div class="requirement-item" data-req="special">One special character</div>
    </div>
</div>
{% endblock %}