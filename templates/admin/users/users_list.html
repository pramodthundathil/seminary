{% extends 'admin/index.html' %}
{% block content %}


<style>
    /* Tweak pagination visuals (put in page or global stylesheet) */
.pagination { display:flex; gap:6px; list-style:none; padding:0; margin:0; flex-wrap:wrap; align-items:center; }
.pagination .page-link { display:inline-block; padding:6px 10px; border-radius:6px; border:1px solid transparent; text-decoration:none; color:inherit; }
.pagination .active .page-link { background:#111827; color:#fff; border-color:transparent; font-weight:700; }
.pagination .disabled .page-link { color:#9CA3AF; cursor:default; }
@media(max-width:600px) {
  .pagination .page-link { padding:6px 8px; font-size:13px; }
}

</style>
<div class="gallery-container">
    <div class="page-header" style="display:flex;justify-content:space-between;align-items:center;">
        <h1>Users</h1>

        <div style="display:flex;gap:12px;align-items:center;">
            <form method="get" id="perPageForm" style="display:flex;gap:8px;align-items:center;">
                {# Preserve other GET params #}
                {% for key, value in request.GET.items %}
                    {% if key != 'per_page' and key != 'page' %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endif %}
                {% endfor %}

                <label class="small-muted" for="per_page">Show</label>
                <select name="per_page" id="per_page" class="form-select" onchange="document.getElementById('perPageForm').submit();" style="width:90px;">
                    <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                    <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                    <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                    <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                </select>
                <span class="small-muted">per page</span>
            </form>
        </div>
    </div>

    <div class="table-container" style="margin-top:12px;">
        <table class="table" style="width:100%; border-collapse:collapse;">
            <thead>
                <tr>
                    <th style="width:60px;">ID</th>
                    <th>User</th>
                    <th>Email</th>
                    <th style="width:120px;">Status</th>
                    <th style="width:160px;">Created At</th>
                    <th style="width:120px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for u in page_obj.object_list %}
                <tr>
                    <td>{{ u.id }}</td>
                    <td>
                        <div style="line-height:1.4;">
                            <strong>{{ u.username }}</strong><br>
                            <span style="color:var(--text-light); font-size:13px;">{{ u.name }}</span>
                        </div>
                    </td>
                    <td>{{ u.email }}</td>
                    <td>
                        {% if u.is_active %}
                            <span class="status-badge status-active">Active</span>
                        {% else %}
                            <span class="status-badge status-inactive">Inactive</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if u.created_at %}
                            {{ u.created_at|date:"Y-m-d H:i" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'users_view' u.id %}" class="action-btn view" title="View">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'users_delete' u.id %}" class="action-btn delete"
                           onclick="return confirm('Are you sure you want to delete this user?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center">No users found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# Pagination controls #}
{% load pagination_tags %}

{% if is_paginated %}
<nav aria-label="Page navigation" style="margin-top:16px;">
  <ul class="pagination" style="display:flex;gap:6px;list-style:none;padding:0;margin:0;flex-wrap:wrap;align-items:center;">

    {# Prev #}
    {% if page_obj.has_previous %}
      <li><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">‹ Prev</a></li>
    {% else %}
      <li class="disabled"><span class="page-link">‹ Prev</span></li>
    {% endif %}

    {# Compact page numbers from templatetag #}
    {% get_page_range page_obj 3 as compact_pages %}
    {% for item in compact_pages %}
      {% if item == '...' %}
        <li class="disabled"><span class="page-link">…</span></li>
      {% elif item == page_obj.number %}
        <li class="active"><span class="page-link">{{ item }}</span></li>
      {% else %}
        <li><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ item }}">{{ item }}</a></li>
      {% endif %}
    {% endfor %}

    {# Next #}
    {% if page_obj.has_next %}
      <li><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next ›</a></li>
    {% else %}
      <li class="disabled"><span class="page-link">Next ›</span></li>
    {% endif %}

  </ul>
</nav>
{% endif %}


</div>

{% endblock %}
