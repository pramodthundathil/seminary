{% extends "site_pages/index.html" %}

{% block title %}
<title>New Application Form - Trinity Theological Seminary</title>
{% endblock %}

{% block content %}
<!-- Application Form Section -->
<section class="about-section application-section">
    <div class="container">
        <h2 class="section-title">New Application <span class="highlight">Form</span></h2>

        <div class="intro-section">
            <p>
                Complete the form below to submit your application. All fields marked with
                <span class="required">*</span> are required. For questions regarding the
                application process, please contact our admissions office.
            </p>
        </div>

        <!-- Application Form -->
        <div class="application-form-wrapper">
            <form method="POST" action="" class="application-form" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Personal Information -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="first_name">First Name <span class="required">*</span></label>
                        <input type="text" id="first_name" name="first_name" placeholder="Enter your first name"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="middle_name">Middle Name</label>
                        <input type="text" id="middle_name" name="middle_name" placeholder="Optional">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="last_name">Last Name <span class="required">*</span></label>
                        <input type="text" id="last_name" name="last_name" placeholder="Enter your last name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email <span class="required">*</span></label>
                        <input type="email" id="email" name="email" placeholder="example@email.com" required>
                        <span class="error-msg" id="email_error"></span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="gender">Gender <span class="required">*</span></label>
                        <select id="gender" name="gender" required>
                            <option value="">--- Select Gender ---</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="citizenship">Citizenship <span class="required">*</span></label>
                        <select id="citizenship" name="citizenship" required>
                            <option value="">--- Select Country ---</option>

                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number <span class="required">*</span></label>
                        <div class="phone-input-wrapper">
                            <select class="country-code" name="country_code">
                                <option value="+1">+1</option>
                                <option value="+91">+91</option>
                                <option value="+44">+44</option>
                            </select>
                            <input type="tel" id="phone" name="phone" placeholder="(555) 123-4567" required>
                            <span class="error-msg" id="phone_error"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth <span class="required">*</span></label>
                        <input type="date" id="dob" name="dob" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="marital_status">Marital Status <span class="required">*</span></label>
                        <select id="marital_status" name="marital_status" required>
                            <option value="">--- Select Marital Status ---</option>
                            <option value="single">Single</option>
                            <option value="married">Married</option>
                            <option value="divorced">Divorced</option>
                            <option value="widowed">Widowed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="spouse_name">Spouse Name</label>
                        <input type="text" id="spouse_name" name="spouse_name" placeholder="If married">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="children">Children</label>
                        <input type="text" id="children" name="children" placeholder="Number of children">
                    </div>
                    <div class="form-group">
                        <label for="mailing_address">Mailing Address <span class="required">*</span></label>
                        <input type="text" id="mailing_address" name="mailing_address"
                            placeholder="Street address, P.O. box" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City <span class="required">*</span></label>
                        <input type="text" id="city" name="city" placeholder="Enter city" required>
                    </div>
                    <div class="form-group">
                        <label for="state">State <span class="required">*</span></label>
                        <input type="text" id="state" name="state" placeholder="Enter state/province" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="country">Country <span class="required">*</span></label>
                        <select id="country" name="country" required>
                            <option value="">--- Select Country ---</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="zipcode">Zipcode <span class="required">*</span></label>
                        <input type="text" id="zipcode" name="zipcode" placeholder="Postal code" required>
                    </div>
                </div>

                <!-- Academic Information -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="timezone">Timezone <span class="required">*</span></label>
                        <select id="timezone" name="timezone" required>
                            <option value="">--- Select Timezone ---</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="education">Highest Education Attained <span class="required">*</span></label>
                        <select id="education" name="education" required>
                            <option value="">--- Select Highest Education ---</option>
                            <option value="high_school">High School</option>
                            <option value="bachelors">Bachelor's Degree</option>
                            <option value="masters">Master's Degree</option>
                            <option value="doctorate">Doctorate</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="course">Course Applied <span class="required">*</span></label>
                        <select id="course" name="course" required>
                            <option value="">--- Select a Course ---</option>
                            <option value="undergraduate">Undergraduate Level</option>
                            <option value="masters">Master's Level</option>
                            <option value="doctoral">Doctoral Level</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="language">Language Medium <span class="required">*</span></label>
                        <select id="language" name="language" required>
                            <option value="">--- Select Language ---</option>
                            <option value="english">English</option>
                            <option value="hindi">Hindi</option>
                            <option value="spanish">Spanish</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="start_year">Anticipated Starting Year <span class="required">*</span></label>
                        <select id="start_year" name="start_year" required>
                            <option value="">--- Select Starting Year ---</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ministerial_status">Ministerial Status <span class="required">*</span></label>
                        <select id="ministerial_status" name="ministerial_status" required>
                            <option value="">--- Select Ministerial Status ---</option>
                            <option value="ordained">Ordained Minister</option>
                            <option value="licensed">Licensed Minister</option>
                            <option value="layperson">Layperson</option>
                            <option value="student">Student</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="church">Church Affiliation <span class="required">*</span></label>
                        <input type="text" id="church" name="church" placeholder="Enter your church name" required>
                    </div>
                </div>

                <!-- Financial Information -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="scholarship">Scholarship Needed : <span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="scholarship" value="yes" required> Yes</label>
                            <label><input type="radio" name="scholarship" value="no" required> No</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="employed">Are you Currently Employed <span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="employed" value="yes" required> Yes</label>
                            <label><input type="radio" name="employed" value="no" required> No</label>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="income">Monthly Income (In US Dollars $)</label>
                        <select id="income" name="income">
                            <option value="">--- Select Income Range ---</option>
                            <option value="0-500">$0 - $500</option>
                            <option value="500-1000">$500 - $1000</option>
                            <option value="1000-2000">$1000 - $2000</option>
                            <option value="2000+">$2000+</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="afford">How much can you afford for your course? <span
                                class="required">*</span></label>
                        <select id="afford" name="afford" required>
                            <option value="">--- Select Affordable Amount ---</option>
                            <option value="0-100">$0 - $100</option>
                            <option value="100-200">$100 - $200</option>
                            <option value="200-500">$200 - $500</option>
                            <option value="500+">$500+</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="message">Message</label>
                        <textarea id="message" name="message" rows="5"
                            placeholder="Tell us about yourself, your goals, and why you want to join this program..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="profile_pic">Profile Pic</label>
                        <input type="file" id="profile_pic" name="profile_pic" accept="image/*">
                        <span class="error-msg" id="profile_pic_error"></span>
                    </div>
                </div>

                <!-- Things to be Done Section -->
                <div class="section-header">THINGS TO BE DONE</div>

                <div class="instructions">
                    <p><strong>1.</strong> Please complete the project questionnaire form below so we can prepare a
                        quote for you. We understand the importance of keeping your information, ideas and project
                        venture private.</p>
                    <p><strong>2.</strong> Send three References one from Your Pastor Second Your Friend and Third Your
                        Relative along with their Name, email ID, Mailing Address and Contact Number.</p>
                </div>

                <!-- Reference 1 -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="ref1_name">Reference No.1 (Name) <span class="required">*</span></label>
                        <input type="text" id="ref1_name" name="ref1_name" placeholder="Pastor's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="ref1_email">Email <span class="required">*</span></label>
                        <input type="email" id="ref1_email" name="ref1_email" placeholder="pastor@church.com" required>
                        <span class="error-msg" id="ref1_email_error"></span>

                    </div>
                    <div class="form-group">
                        <label for="ref1_phone">Phone Number</label>
                        <input type="tel" id="ref1_phone" name="ref1_phone" placeholder="(555) 123-4567">
                        <span class="error-msg" id="ref1_phone_error"></span>
                    </div>
                </div>

                <!-- Reference 2 -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="ref2_name">Reference No.2 (Name) <span class="required">*</span></label>
                        <input type="text" id="ref2_name" name="ref2_name" placeholder="Friend's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="ref2_email">Email <span class="required">*</span></label>
                        <input type="email" id="ref2_email" name="ref2_email" placeholder="friend@email.com" required>
                        <span class="error-msg" id="ref2_email_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="ref2_phone">Phone Number</label>
                        <input type="tel" id="ref2_phone" name="ref2_phone" placeholder="(555) 123-4567">
                        <span class="error-msg" id="ref2_phone_error"></span>
                    </div>
                </div>

                <!-- Reference 3 -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="ref3_name">Reference No.3 (Name) <span class="required">*</span></label>
                        <input type="text" id="ref3_name" name="ref3_name" placeholder="Relative's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="ref3_email">Email <span class="required">*</span></label>
                        <input type="email" id="ref3_email" name="ref3_email" placeholder="relative@email.com" required>
                        <span class="error-msg" id="ref3_email_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="ref3_phone">Phone Number</label>
                        <input type="tel" id="ref3_phone" name="ref3_phone" placeholder="(555) 123-4567">
                        <span class="error-msg" id="ref3_phone_error"></span>
                    </div>
                </div>

                <!-- Upload Certificates Section -->
                <div class="section-header">
                    <i class="fas fa-certificate"></i> UPLOAD YOUR CERTIFICATES
                </div>

                <div class="form-row certificates-row">
                    <div class="form-group">
                        <label for="cert1">Certificate1 <span class="required">*</span></label>
                        <div class="file-input-group">
                            <input type="text" readonly placeholder="No file selected">
                            <input type="file" id="cert1" name="cert1" style="display: none;" required>
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert1').click()">Select file</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cert2">Certificate2</label>
                        <div class="file-input-group">
                            <input type="text" readonly placeholder="No file selected">
                            <input type="file" id="cert2" name="cert2" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert2').click()">Select file</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cert3">Certificate3</label>
                        <div class="file-input-group">
                            <input type="text" readonly placeholder="No file selected">
                            <input type="file" id="cert3" name="cert3" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert3').click()">Select file</button>
                        </div>
                    </div>
                </div>

                <div class="form-row certificates-row">
                    <div class="form-group">
                        <label for="cert4">Certificate4</label>
                        <div class="file-input-group">
                            <input type="text" readonly placeholder="No file selected">
                            <input type="file" id="cert4" name="cert4" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert4').click()">Select file</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cert5">Certificate5</label>
                        <div class="file-input-group">
                            <input type="text" readonly placeholder="No file selected">
                            <input type="file" id="cert5" name="cert5" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert5').click()">Select file</button>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="form-submit">
                    <button type="submit" class="btn-apply-submit">APPLY</button>
                </div>
            </form>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector(".application-form");
        const fields = [
            "first_name", "last_name", "email", "gender", "citizenship", "phone", "dob",
            "marital_status", "mailing_address", "city", "state", "country", "zipcode",
            "timezone", "education", "course", "language", "start_year", "ministerial_status",
            "church", "afford", "ref1_name", "ref1_email", "ref2_name", "ref2_email",
            "ref3_name", "ref3_email", "ref1_phone", "ref2_phone", "ref3_phone"
        ];
        /* -------------------------------------------
         AUTO-LOAD ALL COUNTRIES INTO SELECT BOX
        -------------------------------------------- */

        const allCountries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda",
            "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan",
            "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium",
            "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana",
            "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi",
            "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic",
            "Chad", "Chile", "China", "Colombia", "Comoros", "Congo (Congo-Brazzaville)",
            "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic",
            "Denmark", "Djibouti", "Dominica", "Dominican Republic",
            "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia",
            "Eswatini", "Ethiopia",
            "Fiji", "Finland", "France",
            "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada",
            "Guatemala", "Guinea", "Guinea-Bissau", "Guyana",
            "Haiti", "Honduras", "Hungary",
            "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy",
            "Jamaica", "Japan", "Jordan",
            "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan",
            "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya",
            "Liechtenstein", "Lithuania", "Luxembourg",
            "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta",
            "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia",
            "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar",
            "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua",
            "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway",
            "Oman",
            "Pakistan", "Palau", "Panama", "Papua New Guinea", "Paraguay", "Peru",
            "Philippines", "Poland", "Portugal",
            "Qatar",
            "Romania", "Russia", "Rwanda",
            "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines",
            "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal",
            "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia",
            "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan",
            "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland",
            "Syria",
            "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste",
            "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey",
            "Turkmenistan", "Tuvalu",
            "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom",
            "United States", "Uruguay", "Uzbekistan",
            "Vanuatu", "Vatican City", "Venezuela", "Vietnam",
            "Yemen",
            "Zambia", "Zimbabwe"
        ];

        // Load into select box
        const citizenshipSelect = document.getElementById("citizenship");
        const countrySelect = document.getElementById("country");

        // Sort alphabetically
        allCountries.sort();

        allCountries.forEach(country => {
            // Option for citizenship
            const option1 = document.createElement("option");
            option1.value = country.toLowerCase().replace(/ /g, "_");
            option1.textContent = country;

            // Option for country
            const option2 = document.createElement("option");
            option2.value = country.toLowerCase().replace(/ /g, "_");
            option2.textContent = country;

            citizenshipSelect.appendChild(option1);
            countrySelect.appendChild(option2);
        });
        /* Starting year select*/
        const startYearSelect = document.getElementById("start_year");
        const currentYear = new Date().getFullYear();
        const yearsAhead = 10;

        for (let i = currentYear; i <= currentYear + yearsAhead; i++) {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = i;
            startYearSelect.appendChild(option);
        }

        // ------------------------
        // Load Timezones Dynamically
        // ------------------------
        function loadTimezones() {
            const timezoneSelect = document.getElementById("timezone");

            // List of IANA time zones
            const timezones = Intl.supportedValuesOf('timeZone');

            // Sort alphabetically
            timezones.sort();

            // Populate select
            timezones.forEach(tz => {
                const option = document.createElement("option");
                option.value = tz;
                option.textContent = tz;
                timezoneSelect.appendChild(option);
            });
        }

        // Call function
        loadTimezones();

        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

        countryEl.addEventListener("change", function () {
            updateStates();
            validateField("country");
        });

        stateEl.addEventListener("change", function () {
            updateCities();
            validateField("state");
        });

        cityEl.addEventListener("change", function () {
            validateField("city");
        });

        /* ----------------------------------------------------------
           LIVE VALIDATION
        ---------------------------------------------------------- */
        fields.forEach(id => {
            let el = document.getElementById(id);
            el.addEventListener("input", function () {
                validateField(id);
                validateForm();
            });
        });

        /* ----------------------------------------------------------
           PROFILE PIC VALIDATION
        ---------------------------------------------------------- */
        const profilePic = document.getElementById("profile_pic");
        if (profilePic) {
            profilePic.addEventListener("change", function () {
                validateProfilePic();
                validateForm();
            });
        }

        function validateField(id) {
            let el = document.getElementById(id);
            let errorBox = document.getElementById(id + "_error");
            let value = el.value.trim();
            let error = "";

            if (!value) error = "This field is required";

            if (["email", "ref1_email", "ref2_email", "ref3_email"].includes(id)) {
                if (value && !emailPattern.test(value))
                    error = "Invalid email format";
            }

            if (["phone", "ref1_phone", "ref2_phone", "ref3_phone"].includes(id)) {
                if (!/^[0-9]+$/.test(value)) error = "Digits only";
                else if (value.length < 7 || value.length > 15)
                    error = "Phone number must be 7–15 digits";
            }

            if (id === "zipcode" && !/^[0-9]{4,10}$/.test(value)) {
                error = "Zipcode must be 4–10 digits";
            }

            if (id === "start_year") {
                const year = parseInt(value);
                let currentYear = new Date().getFullYear();
                if (isNaN(year) || year < 1950 || year > currentYear + 1)
                    error = "Invalid start year";
            }
            if (error) {
                el.classList.add("input-error");
                el.classList.remove("input-valid");
                errorBox.textContent = error;
                return false;
            } else {
                el.classList.remove("input-error");
                el.classList.add("input-valid");
                errorBox.textContent = "";
                return true;
            }
        }

        function validateProfilePic() {
            const fileInput = document.getElementById("profile_pic");
            const errorBox = document.getElementById("profile_pic_error");

            if (!fileInput || fileInput.files.length === 0) {
                errorBox.textContent = "";
                return true;
            }

            const file = fileInput.files[0];
            const validTypes = ["image/jpeg", "image/png", "image/jpg", "image/webp", "image/gif"];

            if (!validTypes.includes(file.type)) {
                errorBox.textContent = "Only JPG, PNG, WEBP or GIF allowed";
                return false;
            }

            if (file.size > 2 * 1024 * 1024) {
                errorBox.textContent = "Image must be less than 2 MB";
                return false;
            }

            errorBox.textContent = "";
            return true;
        }

        /* ----------------------------------------------------------
           CERTIFICATE VALIDATION
        ---------------------------------------------------------- */
        function validateCertificate(inputId, required = false) {
            const input = document.getElementById(inputId);
            const errorBox = document.getElementById(inputId + "_error");

            if (required && input.files.length === 0) {
                errorBox.textContent = "This certificate is required";
                return false;
            }

            if (input.files.length > 0) {
                const file = input.files[0];
                const validTypes = ["application/pdf", "image/jpeg", "image/png"];

                if (!validTypes.includes(file.type)) {
                    errorBox.textContent = "Only PDF, JPG, or PNG allowed";
                    return false;
                }
                if (file.size > 3 * 1024 * 1024) {
                    errorBox.textContent = "File must be under 3 MB";
                    return false;
                }
            }

            errorBox.textContent = "";
            return true;
        }

        /* ----------------------------------------------------------
           FORM VALIDATION ON SUBMIT
        ---------------------------------------------------------- */
        function validateForm() {
            let allValid = true;

            fields.forEach(id => {
                if (!validateField(id)) allValid = false;
            });

            if (!validateProfilePic()) allValid = false;

            if (!validateCertificate("cert1", true)) allValid = false;
            if (!validateCertificate("cert2")) allValid = false;
            if (!validateCertificate("cert3")) allValid = false;
            if (!validateCertificate("cert4")) allValid = false;
            if (!validateCertificate("cert5")) allValid = false;

            return allValid;
        }

        form.addEventListener("submit", function (e) {
            if (!validateForm()) {
                e.preventDefault();
                alert("Please fix the highlighted errors before submitting.");
            }
        });

    });
</script>

{% endblock %}