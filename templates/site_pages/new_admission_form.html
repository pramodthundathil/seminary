{% extends "site_pages/index.html" %}

{% block title %}
<title>New Application Form - Trinity Theological Seminary</title>
{% endblock %}

{% block content %}
<!-- Application Form Section -->
<section class="about-section application-section">
    <div class="container">
        <h2 class="section-title">New Application <span class="highlight">Form</span></h2>

        <div class="intro-section">
            <p>
                Complete the form below to submit your application. All fields marked with
                <span class="required">*</span> are required. For questions regarding the
                application process, please contact our admissions office.
            </p>
        </div>

        <!-- Application Form -->
        <div class="application-form-wrapper">
            <form method="POST" action="" class="application-form" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Personal Information -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="first_name">First Name <span class="required">*</span></label>
                        <input type="text" id="first_name" name="first_name" required>
                    </div>
                    <div class="form-group">
                        <label for="middle_name">Middle Name</label>
                        <input type="text" id="middle_name" name="middle_name">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="last_name">Last Name <span class="required">*</span></label>
                        <input type="text" id="last_name" name="last_name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email <span class="required">*</span></label>
                        <input type="email" id="email" name="email" required>
                        <span class="error-msg" id="email_error"></span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="gender">Gender <span class="required">*</span></label>
                        <select id="gender" name="gender" required>
                            <option value="">---Select Gender---</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="citizenship">Citizenship <span class="required">*</span></label>
                        <select id="citizenship" name="citizenship" required>
                            <option value="">--- Select Country ---</option>
                            <option value="us">United States</option>
                            <option value="in">India</option>
                            <option value="uk">United Kingdom</option>
                            <option value="ca">Canada</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number <span class="required">*</span></label>
                        <div class="phone-input-wrapper">
                            <select class="country-code" name="country_code">
                                <option value="+1">+1</option>
                                <option value="+91">+91</option>
                                <option value="+44">+44</option>
                            </select>
                            <input type="tel" id="phone" name="phone" required>
                            <span class="error-msg" id="phone_error"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth <span class="required">*</span></label>
                        <input type="date" id="dob" name="dob" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="marital_status">Marital Status <span class="required">*</span></label>
                        <select id="marital_status" name="marital_status" required>
                            <option value="">---Select Marital Status---</option>
                            <option value="single">Single</option>
                            <option value="married">Married</option>
                            <option value="divorced">Divorced</option>
                            <option value="widowed">Widowed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="spouse_name">Spouse Name</label>
                        <input type="text" id="spouse_name" name="spouse_name">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="children">Children</label>
                        <input type="text" id="children" name="children" placeholder="Number of children">
                    </div>
                    <div class="form-group">
                        <label for="mailing_address">Mailing Address <span class="required">*</span></label>
                        <input type="text" id="mailing_address" name="mailing_address" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City <span class="required">*</span></label>
                        <input type="text" id="city" name="city" required>
                    </div>
                    <div class="form-group">
                        <label for="state">State <span class="required">*</span></label>
                        <input type="text" id="state" name="state" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="country">Country <span class="required">*</span></label>
                        <select id="country" name="country" required>
                            <option value="">--- Select Country ---</option>
                            <option value="us">United States</option>
                            <option value="in">India</option>
                            <option value="uk">United Kingdom</option>
                            <option value="ca">Canada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="zipcode">Zipcode <span class="required">*</span></label>
                        <input type="text" id="zipcode" name="zipcode" required>
                    </div>
                </div>

                <!-- Academic Information -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="timezone">Timezone <span class="required">*</span></label>
                        <select id="timezone" name="timezone" required>
                            <option value="">--- Select Timezone ---</option>
                            <option value="est">EST - Eastern Standard Time</option>
                            <option value="cst">CST - Central Standard Time</option>
                            <option value="ist">IST - Indian Standard Time</option>
                            <option value="gmt">GMT - Greenwich Mean Time</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="education">Highest Education Attained <span class="required">*</span></label>
                        <select id="education" name="education" required>
                            <option value="">---Select Highest Education Attained---</option>
                            <option value="high_school">High School</option>
                            <option value="bachelors">Bachelor's Degree</option>
                            <option value="masters">Master's Degree</option>
                            <option value="doctorate">Doctorate</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="course">Course Applied <span class="required">*</span></label>
                        <select id="course" name="course" required>
                            <option value="">---Select a Course---</option>
                            <option value="undergraduate">Undergraduate Level</option>
                            <option value="masters">Master's Level</option>
                            <option value="doctoral">Doctoral Level</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="language">Language Medium <span class="required">*</span></label>
                        <select id="language" name="language" required>
                            <option value="">--- Select Language ---</option>
                            <option value="english">English</option>
                            <option value="hindi">Hindi</option>
                            <option value="spanish">Spanish</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="start_year">Anticipated Starting Year <span class="required">*</span></label>
                        <select id="start_year" name="start_year" required>
                            <option value="">--- Select Starting year ---</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ministerial_status">Ministerial Status <span class="required">*</span></label>
                        <select id="ministerial_status" name="ministerial_status" required>
                            <option value="">---Select Ministerial Status---</option>
                            <option value="ordained">Ordained Minister</option>
                            <option value="licensed">Licensed Minister</option>
                            <option value="layperson">Layperson</option>
                            <option value="student">Student</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="church">Church Affiliation <span class="required">*</span></label>
                        <input type="text" id="church" name="church" required>
                    </div>
                </div>

                <!-- Financial Information -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="scholarship">Scholarship Needed : <span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="scholarship" value="yes" required> Yes</label>
                            <label><input type="radio" name="scholarship" value="no" required> No</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="employed">Are you Currently Employed <span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="employed" value="yes" required> Yes</label>
                            <label><input type="radio" name="employed" value="no" required> No</label>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="income">Monthly Income (In US Dollars $)</label>
                        <select id="income" name="income">
                            <option value="">---Select Income---</option>
                            <option value="0-500">$0 - $500</option>
                            <option value="500-1000">$500 - $1000</option>
                            <option value="1000-2000">$1000 - $2000</option>
                            <option value="2000+">$2000+</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="afford">How much can you afford for your course? <span
                                class="required">*</span></label>
                        <select id="afford" name="afford" required>
                            <option value="">---Select Affordable Amount---</option>
                            <option value="0-100">$0 - $100</option>
                            <option value="100-200">$100 - $200</option>
                            <option value="200-500">$200 - $500</option>
                            <option value="500+">$500+</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="message">Message</label>
                        <textarea id="message" name="message" rows="5"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="profile_pic">Profile Pic</label>
                        <input type="file" id="profile_pic" name="profile_pic" accept="image/*">
                        <span class="error-msg" id="profile_pic_error"></span>
                    </div>
                </div>

                <!-- Things to be Done Section -->
                <div class="section-header">THINGS TO BE DONE</div>

                <div class="instructions">
                    <p><strong>1.</strong> Please complete the project questionnaire form below so we can prepare a
                        quote for you. We understand the importance of keeping your information, ideas and project
                        venture private.</p>
                    <p><strong>2.</strong> Send three References one from Your Pastor Second Your Friend and Third Your
                        Relative along with their Name, email ID, Mailing Address and Contact Number.</p>
                </div>

                <!-- Reference 1 -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="ref1_name">Reference No.1 (Name) <span class="required">*</span></label>
                        <input type="text" id="ref1_name" name="ref1_name" required>
                    </div>
                    <div class="form-group">
                        <label for="ref1_email">Email <span class="required">*</span></label>
                        <input type="email" id="ref1_email" name="ref1_email" required>
                        <span class="error-msg" id="ref1_email_error"></span>

                    </div>
                    <div class="form-group">
                        <label for="ref1_phone">Phone Number</label>
                        <input type="tel" id="ref1_phone" name="ref1_phone">
                        <span class="error-msg" id="ref1_phone_error"></span>
                    </div>
                </div>

                <!-- Reference 2 -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="ref2_name">Reference No.2 (Name) <span class="required">*</span></label>
                        <input type="text" id="ref2_name" name="ref2_name" required>
                    </div>
                    <div class="form-group">
                        <label for="ref2_email">Email <span class="required">*</span></label>
                        <input type="email" id="ref2_email" name="ref2_email" required>
                        <span class="error-msg" id="ref2_email_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="ref2_phone">Phone Number</label>
                        <input type="tel" id="ref2_phone" name="ref2_phone">
                        <span class="error-msg" id="ref2_phone_error"></span>
                    </div>
                </div>

                <!-- Reference 3 -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="ref3_name">Reference No.3 (Name) <span class="required">*</span></label>
                        <input type="text" id="ref3_name" name="ref3_name" required>
                    </div>
                    <div class="form-group">
                        <label for="ref3_email">Email <span class="required">*</span></label>
                        <input type="email" id="ref3_email" name="ref3_email" required>
                        <span class="error-msg" id="ref3_email_error"></span>
                    </div>
                    <div class="form-group">
                        <label for="ref3_phone">Phone Number</label>
                        <input type="tel" id="ref3_phone" name="ref3_phone">
                        <span class="error-msg" id="ref3_phone_error"></span>
                    </div>
                </div>

                <!-- Upload Certificates Section -->
                <div class="section-header">
                    <i class="fas fa-certificate"></i> UPLOAD YOUR CERTIFICATES
                </div>

                <div class="form-row certificates-row">
                    <div class="form-group">
                        <label for="cert1">Certificate1 <span class="required">*</span></label>
                        <div class="file-input-group">
                            <input type="text" readonly>
                            <input type="file" id="cert1" name="cert1" style="display: none;" required>
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert1').click()">Select file</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cert2">Certificate2</label>
                        <div class="file-input-group">
                            <input type="text" readonly>
                            <input type="file" id="cert2" name="cert2" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert2').click()">Select file</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cert3">Certificate3</label>
                        <div class="file-input-group">
                            <input type="text" readonly>
                            <input type="file" id="cert3" name="cert3" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert3').click()">Select file</button>
                        </div>
                    </div>
                </div>

                <div class="form-row certificates-row">
                    <div class="form-group">
                        <label for="cert4">Certificate4</label>
                        <div class="file-input-group">
                            <input type="text" readonly>
                            <input type="file" id="cert4" name="cert4" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert4').click()">Select file</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cert5">Certificate5</label>
                        <div class="file-input-group">
                            <input type="text" readonly>
                            <input type="file" id="cert5" name="cert5" style="display: none;">
                            <button type="button" class="file-btn"
                                onclick="document.getElementById('cert5').click()">Select file</button>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="form-submit">
                    <button type="submit" class="btn-apply-submit">APPLY</button>
                </div>
            </form>
        </div>
    </div>
</section>
<script>
    document.addEventListener("DOMContentLoaded", function () {

        const form = document.querySelector(".application-form");
        const submitBtn = document.querySelector("button[type='submit']");

        // All fields list
        const fields = [
            "first_name", "last_name", "email", "gender", "citizenship", "phone", "dob",
            "marital_status", "mailing_address", "city", "state", "country", "zipcode",
            "timezone", "education", "course", "language", "start_year", "ministerial_status",
            "church", "afford", "ref1_name", "ref1_email", "ref2_name", "ref2_email",
            "ref3_name", "ref3_email", "ref1_phone", "ref2_phone", "ref3_phone"
        ];

        // Email pattern
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

        // Live validation for text fields
        fields.forEach(id => {
            let el = document.getElementById(id);
            el.addEventListener("input", function () {
                validateField(id);
                validateForm();
            });
        });

        // LIVE validation for profile picture
        const profilePic = document.getElementById("profile_pic");
        if (profilePic) {
            profilePic.addEventListener("change", function () {
                validateProfilePic();
                validateForm();
            });
        }

        // Validate a single field
        function validateField(id) {
            let el = document.getElementById(id);
            let errorBox = document.getElementById(id + "_error");
            let value = el.value.trim();
            let error = "";

            // Empty validation
            if (!value) {
                error = "This field is required";
            }

            // Special validations
            if (id === "email" || id === "ref1_email" || id === "ref2_email" || id === "ref3_email") {

                if (value && !emailPattern.test(value)) {
                    error = "Invalid email format";
                }
            }

            if (id === "phone" || id === "ref1_phone" || id === "ref2_phone" || id === "ref3_phone") {

                if (!/^[0-9]+$/.test(value)) {
                    error = "Digits only";
                } else if (value.length < 7 || value.length > 15) {
                    error = "Phone number must be 7–15 digits";
                }
            }

            if (id === "zipcode") {
                if (!/^[0-9]{4,10}$/.test(value))
                    error = "Zipcode must be 4–10 digits";
            }

            if (id === "start_year") {
                const year = parseInt(value);
                let currentYear = new Date().getFullYear();
                if (isNaN(year) || year < 1950 || year > currentYear + 1)
                    error = "Invalid start year";
            }

            // Apply result
            if (error) {
                el.classList.add("input-error");
                el.classList.remove("input-valid");
                errorBox.textContent = error;
                return false;
            } else {
                el.classList.remove("input-error");
                el.classList.add("input-valid");
                errorBox.textContent = "";
                return true;
            }
        }

        // ----------------------------
        // PROFILE PIC VALIDATION
        // ----------------------------
        function validateProfilePic() {
            const fileInput = document.getElementById("profile_pic");
            const errorBox = document.getElementById("profile_pic_error");

            if (!fileInput) return true;

            // If no file selected → optional
            if (fileInput.files.length === 0) {
                errorBox.textContent = "";
                fileInput.classList.remove("input-error");
                fileInput.classList.remove("input-valid");
                return true;
            }

            const file = fileInput.files[0];
            const validTypes = ["image/jpeg", "image/png", "image/jpg", "image/webp", "image/gif"];

            // Wrong format
            if (!validTypes.includes(file.type)) {
                errorBox.textContent = "Only JPG, PNG, WEBP or GIF allowed";
                fileInput.classList.add("input-error");
                fileInput.classList.remove("input-valid");
                return false;
            }

            // Too large
            if (file.size > 2 * 1024 * 1024) {
                errorBox.textContent = "Image must be less than 2 MB";
                fileInput.classList.add("input-error");
                fileInput.classList.remove("input-valid");
                return false;
            }

            // Valid
            errorBox.textContent = "";
            fileInput.classList.remove("input-error");
            fileInput.classList.add("input-valid");
            return true;
        }

        // Validate entire form
        function validateForm() {
            let allValid = true;

            fields.forEach(id => {
                if (!validateField(id)) {
                    allValid = false;
                }
            });

            // Certificate validation
            let cert1 = document.getElementById("cert1");
            let cert1Error = document.getElementById("cert1_error");

            if (cert1 && cert1.files.length === 0) {
                cert1Error.textContent = "Certificate 1 is required";
                allValid = false;
            } else {
                cert1Error.textContent = "";
            }

            // Profile pic validation added here
            if (!validateProfilePic()) {
                allValid = false;
            }

            submitBtn.disabled = !allValid;
            return allValid;
        }

        // Submit event
        form.addEventListener("submit", function (e) {
            if (!validateForm()) {
                e.preventDefault();

                // Auto scroll to first visible error
                const firstError = document.querySelector(".input-error");
                if (firstError) {
                    firstError.scrollIntoView({ behavior: "smooth", block: "center" });
                }
            }
        });
        document.querySelectorAll(".file-input-group").forEach(group => {
            const textBox = group.querySelector("input[type='text']");
            const fileInput = group.querySelector("input[type='file']");

            fileInput.addEventListener("change", function () {
                if (fileInput.files.length > 0) {
                    textBox.value = fileInput.files[0].name;
                } else {
                    textBox.value = "";
                }
            });
        });
    });
</script>

{% endblock %}