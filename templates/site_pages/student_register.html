{% extends "site_pages/index.html" %}

{% block title %}
<title>Payment - Trinity Theological Seminary</title>
{% endblock %}

{% block content %}
<!-- Payment Form Section -->
<section class="about-section payment-section">
    <div class="container">
        <h2 class="section-title">Make a <span class="highlight">Payment</span></h2>

        <div class="intro-section">
            <p>
                Complete the form below to process your payment. All fields marked with <span class="required">*</span> are required. 
                For questions regarding payments, please contact our admissions office.
            </p>
        </div>

        <!-- Payment Form -->
        <div class="payment-form-wrapper">
            
            <form method="POST" action="" class="payment-form" novalidate>
                {% csrf_token %}

                <!-- Personal Information Section -->
                <div class="form-section">
                    <h3 class="form-section-title">Personal Information</h3>
                    
                    <!-- Row 1: Full Name -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="full_name">Full Name <span class="required">*</span></label>
                            <input 
                                type="text" 
                                id="full_name" 
                                name="full_name" 
                                placeholder="Enter your full name"
                                autocomplete="name"
                                required
                                aria-required="true">
                            <span class="error-message" role="alert"></span>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address <span class="required">*</span></label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                placeholder="example@email.com"
                                autocomplete="email"
                                required
                                aria-required="true">
                            <span class="error-message" role="alert"></span>
                        </div>
                    </div>

                    <!-- Row 2: Contact Number and Student ID -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contact">Contact Number <span class="required">*</span></label>
                            <input 
                                type="tel" 
                                id="contact" 
                                name="contact" 
                                placeholder="(555) 123-4567"
                                autocomplete="tel"
                                required
                                aria-required="true">
                            <span class="error-message" role="alert"></span>
                        </div>
                        <div class="form-group">
                            <label for="student_id">Student ID <span class="optional-text">(if applicable)</span></label>
                            <input 
                                type="text" 
                                id="student_id" 
                                name="student_id"
                                placeholder="Enter your student ID">
                            <small class="field-help">Leave blank if you're not currently enrolled</small>
                        </div>
                    </div>
                </div>

                <!-- Payment Details Section -->
                <div class="form-section">
                    <h3 class="form-section-title">Payment Details</h3>
                    
                    <!-- Row 3: Payment Type and Course -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="payment_type">Payment Type <span class="required">*</span></label>
                            <select 
                                id="payment_type" 
                                name="payment_type" 
                                required
                                aria-required="true">
                                <option value="">--- Select Payment Type ---</option>
                                <option value="tuition">Tuition Fee</option>
                                <option value="enrollment">Enrollment Fee</option>
                                <option value="application">Application Fee</option>
                                <option value="course">Course Fee</option>
                                <option value="library">Library Fee</option>
                                <option value="other">Other</option>
                            </select>
                            <span class="error-message" role="alert"></span>
                        </div>
                        <div class="form-group">
                            <label for="course">Course/Program</label>
                            <select id="course" name="course">
                                <option value="">--- Select Program Level ---</option>
                                <option value="undergraduate">Undergraduate Level</option>
                                <option value="masters">Master's Level</option>
                                <option value="doctoral">Doctoral Level</option>
                                <option value="certificate">Certificate Program</option>
                                <option value="continuing">Continuing Education</option>
                            </select>
                            <small class="field-help">Select if payment is for a specific program</small>
                        </div>
                    </div>

                    <!-- Row 4: Amount -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="amount">Payment Amount <span class="required">*</span></label>
                            <div class="amount-input-wrapper">
                                <span class="currency-symbol">$</span>
                                <input 
                                    type="number" 
                                    id="amount" 
                                    name="amount" 
                                    step="0.01" 
                                    min="1"
                                    placeholder="0.00"
                                    required
                                    aria-required="true">
                            </div>
                            <span class="error-message" role="alert"></span>
                        </div>
                    </div>
                </div>

                <!-- Additional Information Section -->
                <div class="form-section">
                    <h3 class="form-section-title">Additional Information</h3>
                    
                    <!-- Message/Notes -->
                    <div class="form-group full-width">
                        <label for="message">Message/Notes <span class="optional-text">(Optional)</span></label>
                        <textarea 
                            id="message" 
                            name="message" 
                            rows="5"
                            placeholder="Add any additional information or special instructions here..."
                            maxlength="500"></textarea>
                        <small class="character-count">0 / 500 characters</small>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="form-submit">
                    <button type="submit" class="btn-submit">
                        <span class="btn-text">PROCEED TO PAYMENT</span>
                        <span class="btn-icon">â†’</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<script>
// Form validation and UX enhancements
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.payment-form');
    const messageTextarea = document.getElementById('message');
    const charCount = document.querySelector('.character-count');
    
    // Character counter for textarea
    if (messageTextarea && charCount) {
        messageTextarea.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = `${count} / 500 characters`;
            if (count > 450) {
                charCount.style.color = '#dc3545';
            } else {
                charCount.style.color = '#666';
            }
        });
    }
    
    // Real-time validation
    const inputs = form.querySelectorAll('input[required], select[required]');
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            validateField(this);
        });
        
        input.addEventListener('input', function() {
            if (this.classList.contains('error')) {
                validateField(this);
            }
        });
    });
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        let isValid = true;
        
        inputs.forEach(input => {
            if (!validateField(input)) {
                isValid = false;
            }
        });
        
        if (isValid) {
            // Submit the form
            this.submit();
        } else {
            // Scroll to first error
            const firstError = form.querySelector('.error');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
    
    function validateField(field) {
        const errorSpan = field.parentElement.querySelector('.error-message');
        let isValid = true;
        let errorMessage = '';
        
        if (field.hasAttribute('required') && !field.value.trim()) {
            isValid = false;
            errorMessage = 'This field is required';
        } else if (field.type === 'email' && field.value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(field.value)) {
                isValid = false;
                errorMessage = 'Please enter a valid email address';
            }
        } else if (field.type === 'number' && field.value) {
            if (parseFloat(field.value) < 1) {
                isValid = false;
                errorMessage = 'Amount must be at least $1.00';
            }
        } else if (field.id === 'full_name' && field.value.trim()) {
            // Basic full name validation - should have at least 2 words
            const nameParts = field.value.trim().split(/\s+/);
            if (nameParts.length < 2) {
                isValid = false;
                errorMessage = 'Please enter your full name (first and last name)';
            }
        }
        
        if (!isValid) {
            field.classList.add('error');
            if (errorSpan) {
                errorSpan.textContent = errorMessage;
                errorSpan.style.display = 'block';
            }
        } else {
            field.classList.remove('error');
            if (errorSpan) {
                errorSpan.textContent = '';
                errorSpan.style.display = 'none';
            }
        }
        
        return isValid;
    }
    
    // Phone number formatting (basic)
    const phoneInput = document.getElementById('contact');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            
            if (value.length >= 6) {
                e.target.value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6)}`;
            } else if (value.length >= 3) {
                e.target.value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
            } else {
                e.target.value = value;
            }
        });
    }
});
</script>

{% endblock %}